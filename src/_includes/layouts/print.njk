<!DOCTYPE html>
<html dir="ltr" lang="{{ locale }}" class="size-{{ size }}">
<head>
    <meta charset="utf-8" />
    {% set i18n = site[locale] %}
    {% set articles = collections["articles_" + locale] %}
    {% set images = collections["images"] %}
    <title>{{ i18n.title }}</title>
    <meta name="author" content="{{ i18n.author }}" />
    <meta name="subject" content="" />
    <meta name="keywords" content="?" />
    <meta name="date" content="2022" />

    {# needs to be relative for pagedjs to work #}
    <link rel="stylesheet" href="{{ '../../css/global.css' | url }}">
    <link rel="stylesheet" href="../../css/print/common.css">
    <link rel="stylesheet" href="../../css/print/{{ size }}.css">
    <link rel="stylesheet" href="../../css/print/articles-{{ locale }}.css">

    {% include "../partials/page-setup.njk" %}
    {% include "../partials/print-preview.njk" %}
</head>
<body>
    {%- if preview %}
    <div class="front-cover">
        {% image ["front-cover-", locale, ".jpg"] | join %}
    </div>
    <div class="front-collage">
        {% image "front-photos.jpg" %}
    </div>
    {%- endif %}

    {%- for article in articles -%}
        <article class="article-{{ article.data.title | slugify }}">
            <h1 id="{{ article.data.title | slugify }}" class="chapter">{{ article.data.title }}</h1>
            <div class="author">{{ article.data.author }}</div>
            {{ article.data.content | safe }}
        </article>
    {%- endfor -%}

    <div class="contents">
        <h1>{{ i18n.toc }}</h1>

        <ul class="toc">
            {%- for article in articles -%}
                <li><a href="#ch{{ loop.index }}">{{ article.data.title }}</a></li>
            {%- endfor -%}
        </ul>
    </div>

    {%- if preview %}
    <div class="back-collage">
        {% image "back-photos.jpg" %}
    </div>
    <div class="back-cover">
        {% image ["back-cover-", locale, ".jpg"] | join %}
    </div>
    {%- endif %}

    {# {% include "partials/testing.njk" %} #}

    <script>
        class MyHandler extends Paged.Handler {
            constructor(chunker, polisher, caller) {
                super(chunker, polisher, caller);
            }
            // https://www.pagedjs.org/documentation/11-hooks/
            afterRendered(pages) {
                let elem = document.querySelector("h1#bells-of-mindfulness")
                let page = elem.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode
                page.classList.add("bells-of-mindfulness-page")
                console.log("custom script done.", page)
            }

            afterPageLayout(pageElement, page, breakToken) {

                let elem = pageElement.querySelector("img#articlephotosbrother-chan-phap-linhCS21202110152RL0936edited")
                // console.log(elem)
                if (elem) {
                    console.log("SUCCESS")
                    console.log(pageElement)
                    pageElement.classList.add("articlephotosbrother-chan-phap-linhCS21202110152RL0936editedPAGE")
                }

            }
        }
        Paged.registerHandlers(MyHandler);
    </script>
</body>

</html>
